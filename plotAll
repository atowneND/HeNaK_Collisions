#!/bin/bash

rm dtheta.dat

j=16
jp=18
# put these into a for loop for all combinations
jctr=0
echo j jp dtheta >> dtheta.dat

# dqcalc
blamdat=Blambda_$j\_$jp.dat
echo creating $blamdat ...
./dqcalc newdata/Ep002mf5i-50b.blam $blamdat $j $jp

# dq2theta
bthdat=Btheta_$j\_$jp.dat
normblams=Blam_$j\_$jp.dat
echo creating $bthdat ...
echo creating $normblams ...
read alphamin Bmax <<<$(./dq2theta $blamdat $bthdat)

cp $normblams test.dat
sed 's/[\t ][\t ]*/ /g' < test.dat > ntest.dat
col4=$(cut -d' ' -f4 < ntest.dat)
cut -d' ' -f4 < ntest.dat > nout.dat

item=$(sed -n '2{p;q}' nout.dat)
#rm test.dat ntest.dat nout.dat

dtheta=$(awk "BEGIN {printf \"%.4f\n\", $item-$alphamin}")
echo $j $jp $dtheta >> dtheta.dat

# main
#./main.out $j $jp

# plot it
echo "#!/usr/local/gnuplot
set term x11 $jctr
set samples 10000

plot '$normblams' using 3:4 with impulse
replot '$bthdat' using 1:3 with lines smooth csplines

set parametric
set trange [0:$Bmax]
set term x11 $jctr
replot $alphamin,t
" > deleteme2

#gnuplot -persistent < deleteme2
#cat deleteme2
